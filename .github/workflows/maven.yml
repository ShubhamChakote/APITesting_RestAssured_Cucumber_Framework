
  # This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
  # For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven

  name: API Cucumber Workflow

  on:
    push:
      branches: [ "master" ]
    pull_request:
      branches: [ "master" ]

  jobs:
    build:
      runs-on: ubuntu-latest

      steps:
        # Step 1: Checkout repository code
        - name: Checkout Code
          uses: actions/checkout@v4
          with:
            fetch-depth: 0

        # Step 2: Setup Java JDK 11
        - name: Set up JDK 11
          uses: actions/setup-java@v4
          with:
            java-version: '11'
            distribution: 'temurin'
            cache: maven

        # Step 3: Build the project
        - name: Build with Maven
          run: mvn clean compile -DskipTests

        # Step 4: Run Cucumber Tests
        - name: Run Cucumber Tests
          run: mvn test -Dcucumber.filter.tags="@bookerAPI"
          continue-on-error: true

        # Step 5: Run Verify (generates reports)
        - name: Generate Reports
          run: mvn verify -DskipTests
          continue-on-error: true

        # Step 6: List all generated files (for debugging)
        - name: List Target Directory
          if: always()
          run: |
            echo "=== Listing target directory ==="
            find target -type f -name "*.pdf" 2>/dev/null || echo "No PDF files found"
            find target -type f -name "*.html" 2>/dev/null || echo "No HTML files found"
            find target/report -type f 2>/dev/null | head -20 || echo "No report folder found"

        # Step 7: Upload Extent PDF Report
        - name: Upload Extent PDF Report
          if: always()
          uses: actions/upload-artifact@v4
          with:
            name: extent-pdf-report
            path: target/report/ExtentPdf.pdf
            retention-days: 30
            if-no-files-found: warn

        # Step 8: Upload Extent HTML Report
        - name: Upload Extent HTML Report
          if: always()
          uses: actions/upload-artifact@v4
          with:
            name: extent-html-report
            path: target/report/ExtentHtml.html
            retention-days: 30
            if-no-files-found: warn

        # Step 9: Upload Entire Extent Report Folder
        - name: Upload Entire Extent Report Folder
          if: always()
          uses: actions/upload-artifact@v4
          with:
            name: extent-report-folder
            path: target/report/
            retention-days: 30
            if-no-files-found: warn

        # Step 10: Upload Maven Surefire Reports
        - name: Upload Maven Surefire Report
          if: always()
          uses: actions/upload-artifact@v4
          with:
            name: surefire-reports
            path: target/surefire-reports/
            retention-days: 30
            if-no-files-found: warn

        # Step 11: Upload Entire Target Directory (for debugging)
        - name: Upload Build Artifacts
          if: always()
          uses: actions/upload-artifact@v4
          with:
            name: build-artifacts
            path: target/
            retention-days: 7
            if-no-files-found: warn

        # Step 12: Create Summary Report
        - name: Generate Workflow Summary
          if: always()
          run: |
            echo "## üß™ Cucumber Test Execution Summary" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Build Status:** ‚úÖ" >> $GITHUB_STEP_SUMMARY
            echo "**Java Version:** 11" >> $GITHUB_STEP_SUMMARY
            echo "**Build Tool:** Maven" >> $GITHUB_STEP_SUMMARY
            echo "**OS:** ubuntu-latest" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Artifacts Available:**" >> $GITHUB_STEP_SUMMARY
            echo "- üìä ExtentReports PDF (`extent-pdf-report`)" >> $GITHUB_STEP_SUMMARY
            echo "- üìà ExtentReports HTML (`extent-html-report`)" >> $GITHUB_STEP_SUMMARY
            echo "- üì¶ Entire Report Folder (`extent-report-folder`)" >> $GITHUB_STEP_SUMMARY
            echo "- üìã Surefire Reports (`surefire-reports`)" >> $GITHUB_STEP_SUMMARY
            echo "- üîß Build Artifacts (`build-artifacts`)" >> $GITHUB_STEP_SUMMARY

        # Step 13: Notify if Tests Failed
        - name: Check Test Status
          if: failure()
          run: |
            echo "‚ùå Tests Failed!"
            echo "Check the uploaded artifacts for detailed reports"
            exit 1
